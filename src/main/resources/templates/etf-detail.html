<!DOCTYPE html>
<html lang="ko">
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì§„ê²©ì˜ ETF > ì¢…ëª© ìƒì„¸ í˜ì´ì§€</title>
    <link rel="stylesheet" href="/css/style.css">
    <script src="/js/load-components.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-gray-50 text-gray-900">

<!-- Header -->
<!--
<header class="bg-white shadow-md p-4">
    <h1 class="text-2xl font-bold text-blue-600">ETF ì¢…ëª© ìƒì„¸</h1>
</header>
-->

<div id="header-placeholder"></div>

<!-- Main -->
<main class="max-w-7xl mx-auto p-6 grid grid-cols-12 gap-6">

    <!-- Left : ì¢…ëª© ê¸°ë³¸ ì •ë³´ -->
    <aside class="col-span-3 bg-white rounded-2xl shadow p-4">
        <h2 class="text-xl font-semibold mb-3">ğŸ“Š ì¢…ëª© ê¸°ë³¸ ì •ë³´</h2>
        <ul class="space-y-2 text-sm">
            <li><span class="font-medium">ì¢…ëª©ëª…:</span> <span th:text="${etfInfo.itmsNm}"></span></li>
            <li><span class="font-medium">ISINì½”ë“œ:</span> <span th:text="${etfInfo.isinCd}"></span></li>
            <li><span class="font-medium">ì‹œê°€ì´ì•¡:</span> <span th:text="${etfInfo.mrktTotAmt}"></span></li>
            <li><span class="font-medium">ìˆœìì‚°ê°€ì¹˜:</span> <span th:text="${etfInfo.nav}"></span></li>
            <li><span class="font-medium">ìƒì¥ì¼:</span> <span th:text="${etfInfo.basDt}"></span></li>
        </ul>
    </aside>

    <!-- Center : ì°¨íŠ¸ & ì„±ê³¼ -->
    <section class="col-span-6 bg-white rounded-2xl shadow p-4">
        <h2 class="text-xl font-semibold mb-3">ğŸ“ˆ ê°€ê²© & ì„±ê³¼</h2>

        <!-- ì°¨íŠ¸ ì˜ì—­ -->
        <!-- ì°¨íŠ¸ ì»¨í…Œì´ë„ˆì— ë†’ì´ ì§€ì • -->
        <div style="width: 100%; height: 400px;">
            <canvas id="etfChart" class="h-64 w-full"></canvas>
        </div>

        <!-- ì„±ê³¼ í…Œì´ë¸” -->
        <table class="mt-4 w-full text-sm border-t">
            <thead class="bg-gray-50">
            <tr>
                <th class="p-2 text-left">êµ¬ë¶„</th>
                <th class="p-2 text-right">ì „ì²´</th>
                <th class="p-2 text-right">1ë…„</th>
                <th class="p-2 text-right">6ê°œì›”</th>
                <th class="p-2 text-right">3ê°œì›”</th>
                <th class="p-2 text-right">1ê°œì›”</th>
            </tr>
            </thead>
            <tbody>
            <tr class="border-t">
                <td class="p-2 font-medium">ìˆ˜ìµë¥ </td>
                <td id="ret-total" class="p-2 text-right">-</td>
                <td id="ret-1y" class="p-2 text-right">-</td>
                <td id="ret-6m" class="p-2 text-right">-</td>
                <td id="ret-3m" class="p-2 text-right">-</td>
                <td id="ret-1m" class="p-2 text-right">-</td>
            </tr>
            </tbody>
        </table>
    </section>

    <!-- Right : ë‰´ìŠ¤ & í† ë¡  -->
    <aside class="col-span-3 bg-white rounded-2xl shadow p-4">
        <h2 class="text-xl font-semibold mb-3">ğŸ“° ë‰´ìŠ¤ & í† ë¡ </h2>
        <ul class="space-y-3 text-sm">
            <li>
                <a href="#" class="text-blue-600 hover:underline">
                    [ë‰´ìŠ¤] KODEX 200, ê±°ë˜ëŸ‰ ê¸‰ì¦
                </a>
                <p class="text-gray-500 text-xs">2025-10-02</p>
            </li>
            <li>
                <a href="#" class="text-blue-600 hover:underline">
                    [í† ë¡ ] ì¥ê¸° íˆ¬ìí•˜ê¸° ì¢‹ì€ ETFì¼ê¹Œ?
                </a>
                <p class="text-gray-500 text-xs">2025-10-01</p>
            </li>
        </ul>
    </aside>

</main>

<div id="footer-placeholder"></div>

<!-- Chart.js Script -->
<script th:inline="javascript">
    const ctx = document.getElementById('etfChart').getContext('2d');
    const etfData = /*[[${etfDetails}]]*/ []; // Thymeleafë¡œë¶€í„° ë°ì´í„° ë°›ê¸°

    const labels = etfData.map(item => item.basDt);
    const prices = etfData.map(item => item.clpr);

    // ìˆ˜ìµë¥  ê³„ì‚° í•¨ìˆ˜
    const rateOfChange = (start, end) => ((end - start) / start * 100).toFixed(2);

    // ì•ˆì „ ì¸ë±ìŠ¤ ê³„ì‚° (ë°ì´í„°ê°€ ë¶€ì¡±í•˜ë©´ undefined ë°©ì§€)
    const len = prices.length;
    const safeIdx = (n) => (len - n >= 0 ? len - n : 0);

    // êµ¬ê°„ë³„ ìˆ˜ìµë¥  ê³„ì‚°
    const overallChange  = rateOfChange(prices[0], prices[len - 1]);
    const oneYearChange  = rateOfChange(prices[safeIdx(252)], prices[len - 1]);
    const sixMonthChange = rateOfChange(prices[safeIdx(126)], prices[len - 1]);
    const threeMonthChange = rateOfChange(prices[safeIdx(63)], prices[len - 1]);
    const oneMonthChange = rateOfChange(prices[safeIdx(21)], prices[len - 1]);

    // í‘œì‹œìš© í¬ë§· í•¨ìˆ˜
    const formatReturn = (value) => {
      const sign = value >= 0 ? '+' : '';
      const color = value >= 0 ? 'text-red-600' : 'text-blue-600';
      return `<span class="${color}">${sign}${value}%</span>`;
    };

    // í…Œì´ë¸” ì±„ìš°ê¸°
    document.getElementById('ret-total').innerHTML = formatReturn(overallChange);
    document.getElementById('ret-1y').innerHTML    = formatReturn(oneYearChange);
    document.getElementById('ret-6m').innerHTML    = formatReturn(sixMonthChange);
    document.getElementById('ret-3m').innerHTML    = formatReturn(threeMonthChange);
    document.getElementById('ret-1m').innerHTML    = formatReturn(oneMonthChange);

    const etfChart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: labels, // ë‚ ì§œ ë°°ì—´
        datasets: [{
          label: 'ETF ê°€ê²©',
          data: prices, // ì¢…ê°€ ë°°ì—´
          borderColor: 'rgb(37, 99, 235)',
          backgroundColor: 'rgba(37, 99, 235, 0.2)',
          fill: true,
          tension: 0.3,
          pointRadius: 4,
          pointBackgroundColor: 'rgb(37, 99, 235)'
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
          y: {
            beginAtZero: false
          }
        }
      }
    });
</script>

</body>
</html>
